# UI与功能逻辑整合说明

## 🎯 核心设计理念

**本模拟器采用"仿微信聊天窗口"作为唯一交互界面**，所有功能都通过聊天对话的形式实现，不存在独立的操作面板或分离的UI界面。

## 📱 界面结构

### 5个Tab导航
1. **联系孩子** - 私聊功能，伪输入框+建议按钮
2. **家长群** - 群聊功能，家长消息气泡显示  
3. **家长操作** - 物品邮寄、充值等功能
4. **孩子状态** - 状态查看面板
5. **测试模式** - 时间段切换功能

### 输入区域设计
- **伪输入框**：点击后弹出候选面板（3个选项）
- **建议按钮**：点击后弹出建议面板（3个建议）
- 完全符合系统逻辑图要求，不是真正的输入框

## 🔄 完整功能流程

### 1. 联系孩子页面

#### 伪输入框流程
```
点击伪输入框 → 弹出候选面板 → 选择消息 → 家长绿色气泡发送 → 根据时段决定是否立即回复
```

**对应功能规则**：`parent_msg` 候选选择
**UI反馈**：家长绿色气泡 + 延迟孩子白色气泡回复

#### 建议按钮流程
```
点击建议按钮 → 弹出建议面板 → 选择建议 → 家长绿色气泡建议 → 下个时段孩子白色气泡采纳/拒绝
```

**对应功能规则**：`ACT.SUGGESTION.<TOPIC>`
**UI反馈**：家长绿色气泡建议 → 孩子白色气泡回复

#### 来电处理流程
```
系统触发来电弹窗 → 显示孩子/老师来电 → 选择接听/忽略/稍后 → 接听后显示孩子需求 → 3个应答选项 → 进入属性结算
```

**对应功能规则**：`child_call` 事件
**UI反馈**：来电弹窗 → 孩子需求说明 → 应答选项

### 2. 家长群页面

#### 群聊发言流程
```
点击伪输入框 → 弹出候选发言 → 选择发言内容 → 群聊灰色气泡发送 → 群氛围影响
```

**对应功能规则**：`ACT.GROUP_POST.SOOTHE/COMPARE/ASK`
**UI反馈**：群聊灰色气泡 + 群氛围数值变化

#### 系统/老师播报
```
系统自动生成 → 群聊灰色系统消息 → 考试/纪律/活动通知
```

**对应功能规则**：系统广播事件
**UI反馈**：群聊灰色系统消息

### 3. 家长操作页面

#### 寄送物品流程
```
点击寄送物品按钮 → 弹出物品选择面板 → 选择分类与物品 → 确认邮寄 → 系统灰条「已寄送」→ 延迟孩子气泡感谢
```

**对应功能规则**：`ACT.SEND_PARCEL.<ITEM>`
**UI反馈**：系统灰条提示 → 延迟孩子白色气泡反馈

#### 校园卡充值流程
```
点击充值校园卡按钮 → 弹出金额选择面板 → 选择金额 → 确认充值 → 系统灰条「充值成功」→ 下个时段孩子气泡感谢
```

**对应功能规则**：`ACT.RECHARGE.CAMPUS`
**UI反馈**：系统灰条提示 → 下个时段孩子白色气泡感谢

#### 电话卡充值流程
```
点击充值电话卡按钮 → 弹出金额选择面板 → 选择金额 → 确认充值 → 系统灰条「充值成功」→ 下个时段孩子气泡感谢
```

**对应功能规则**：`ACT.RECHARGE.PHONE`
**UI反馈**：系统灰条提示 → 下个时段孩子白色气泡感谢

### 4. 孩子状态页面

#### 状态查看流程
```
点击状态查看按钮 → 弹出状态详情面板 → 显示资金/关系/五维/MBTI/变更日志
```

**对应功能规则**：状态面板显示
**UI反馈**：弹出状态详情面板

### 5. 测试模式页面

#### 时间段切换流程
```
点击时间段按钮 → 切换到对应时段 → 更新当前时段显示 → 触发相应的开场白或批量回复
```

**对应功能规则**：时间段切换逻辑
**UI反馈**：当前时段显示更新

## 🎨 消息类型与视觉设计

### 消息气泡样式
- **家长消息**：绿色气泡，右对齐，带发送者信息
- **孩子消息**：白色气泡，左对齐，带孩子头像
- **系统消息**：灰色背景，居中显示，字体较小
- **群聊消息**：灰色气泡，显示发送者信息

### 弹窗设计
- **候选面板**：居中弹窗，3个选项按钮
- **建议面板**：居中弹窗，3个建议选项
- **操作面板**：居中弹窗，金额/物品选择
- **状态面板**：全屏弹窗，详细信息展示

## ⚡ 关键实现要点

1. **所有功能都通过聊天窗口触发**，不存在独立的操作界面
2. **消息类型明确对应**，每种操作都有对应的视觉反馈
3. **延迟反馈机制**，部分操作需要等待下个时段才能看到孩子回复
4. **时段敏感操作**，某些功能在特定时段会有不同的表现
5. **状态实时更新**，所有操作都会影响孩子的各项数值

## 🔧 开发实现建议

1. **统一消息管理**：所有消息都通过同一个消息管理器处理
2. **事件驱动架构**：UI操作触发事件，功能逻辑响应事件
3. **状态同步机制**：UI状态与游戏状态保持同步
4. **弹窗统一管理**：所有弹窗使用统一的样式和交互逻辑
5. **消息队列系统**：支持延迟消息和批量处理

这样的设计确保了UI与功能逻辑的完全统一，开发人员不会产生"家长端和孩子端分离"的误解，而是完全理解为一个微信风格的聊天模拟器。
